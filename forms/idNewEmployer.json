{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.plugin.SectionWizard",
                        "properties": {
                            "clickableStep": "",
                            "id": "field16",
                            "sections": "section1,section2"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "username",
                            "label": "user name",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "firstName",
                            "label": "firstName",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "lastName",
                            "label": "lastName",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "email",
                            "label": "email",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.PasswordField",
                        "properties": {
                            "id": "idPass",
                            "label": "mot de passe",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.PasswordField",
                        "properties": {
                            "id": "idConfPass",
                            "label": "confirmation mot de passe",
                            "maxlength": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "idRole",
                            "label": "rôle",
                            "multiple": "",
                            "options": [
                                {
                                    "grouping": "",
                                    "label": "Admin",
                                    "value": "admin"
                                },
                                {
                                    "grouping": "",
                                    "label": "User",
                                    "value": "user"
                                }
                            ],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "idTimeZone",
                            "label": "time zone",
                            "multiple": "",
                            "options": [{
                                "grouping": "",
                                "label": "",
                                "value": ""
                            }],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "idStatus",
                            "label": "Status",
                            "multiple": "",
                            "options": [
                                {
                                    "grouping": "",
                                    "label": "Active",
                                    "value": "1"
                                },
                                {
                                    "grouping": "",
                                    "label": "Inactive",
                                    "value": "0"
                                }
                            ],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section1",
                "join": "",
                "label": "USER DETAILS",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "idCodeEmp",
                            "label": "Employée Code",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "idJob",
                            "label": "Job Title",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "idDateStart",
                            "label": "Start Date",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "idDateEnd",
                            "label": "End Date",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "idDepart",
                            "label": "Department",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "idGrade",
                            "label": "Grade",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section2",
                "join": "",
                "label": "EMPLOYEE DETAIL",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "idNewEmployer",
        "loadBinder": {
            "className": "",
            "properties": {}
        },
        "name": "ajouter un nouvelle employé",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "autoHandleFiles": "",
                "autoHandleWorkflowVariable": "true",
                "cacheInterval": "",
                "script": "import java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport javax.sql.DataSource;\nimport org.joget.apps.app.model.AppDefinition;\nimport org.joget.apps.app.service.AppService;\nimport org.joget.apps.app.service.AppUtil;\nimport org.joget.apps.form.model.Element;\nimport org.joget.apps.form.model.FormData;\nimport org.joget.apps.form.model.FormRow;\nimport org.joget.apps.form.model.FormRowSet;\nimport org.joget.apps.form.model.FormStoreBinder;\nimport org.joget.apps.form.service.FormUtil;\nimport org.joget.plugin.base.PluginManager;\nimport org.joget.commons.util.LogUtil;\n  \npublic FormRowSet storeData(Element element, FormRowSet rows, FormData formData) {\n    //check for empty data\n    if (rows == null || rows.isEmpty()) {\n        return rows;\n    }\n    normalStoring(element, rows, formData);\n  \n    //store only needed field by create new Form Row Set\n    FormRow originalRow = rows.get(0);\n    FormRowSet newRows = new FormRowSet();\n    FormRow newRow = new FormRow();\n  \n    newRow.put(\"username\", originalRow.getProperty(\"username\"));\n    newRow.put(\"password\", originalRow.getProperty(\"password\"));\n    newRow.put(\"firstName\", originalRow.getProperty(\"firstName\"));\n    newRow.put(\"lastName\", originalRow.getProperty(\"lastName\"));\n    newRow.put(\"email\", originalRow.getProperty(\"email\"));\n    newRow.put(\"active\", originalRow.getProperty(\"active\"));\n    newRows.add(newRow);\n  \n    String id = \"#currentUser.username#\";\n  \n    //store\n    storeToOtherFormDataTable(element, newRows, formData, id);\n    storeUsingJDBC(element, newRows, formData, id);\n  \n    return rows;\n}\n  \n//this function will reuse workflow form binder to store data\npublic void normalStoring(Element element, FormRowSet rows, FormData formData) {\n    PluginManager pluginManager = (PluginManager) AppUtil.getApplicationContext().getBean(\"pluginManager\");\n    FormStoreBinder binder = (FormStoreBinder) pluginManager.getPlugin(\"org.joget.apps.form.lib.WorkflowFormBinder\");\n    binder.store(element, rows, formData);\n}\n  \n//this function will store rows data to a form's data table\npublic void storeToOtherFormDataTable(Element element, FormRowSet rows, FormData formData, String id) {\n    AppService appService = (AppService) AppUtil.getApplicationContext().getBean(\"appService\");\n  \n    String formId = \"user\"; // the table of database is configured in the form with id \"user\"\n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\n  \n    appService.storeFormData(appDef.getId(), appDef.getVersion().toString(), formId, rows, id);\n}\n  \n//this function will store rows data to external source using JDBC\npublic void storeUsingJDBC(Element element, FormRowSet rows, FormData formData, String id) {\n    Connection con = null;\n    try {\n        // retrieve connection from the default datasource\n        DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\n        con = ds.getConnection();\n  \n        if (!con.isClosed()) {\n            //manually handle insert and update by checking the data is exist or not\n            String selectQuery = \"SELECT username FROM dir_user WHERE username=?\";\n            PreparedStatement stmt = con.prepareStatement(selectQuery);\n            stmt.setString(1, id);\n            ResultSet rs = stmt.executeQuery();\n  \n            Boolean isExist = false;\n            if (rs.next()) {\n                isExist = true;\n            }\n  \n            FormRow row = rows.get(0);\n  \n            if (isExist) {\n                String updateQuery = \"UPDATE dir_user SET firstName = ?, lastName = ?, email = ? WHERE username = ?\";\n                PreparedStatement ustmt = con.prepareStatement(updateQuery);\n                ustmt.setString(1, row.getProperty(\"firstName\"));\n                ustmt.setString(2, row.getProperty(\"lastName\"));\n                ustmt.setString(3, row.getProperty(\"email\"));\n                ustmt.setString(4, id);\n                ustmt.executeUpdate();\n            } else {\n                String insertQuery = \"INSERT INTO dir_user (id, username, firstName, lastName, password, email) values (?, ?, ?, ?, 'md5(password)', ?)\";\n                PreparedStatement istmt = con.prepareStatement(insertQuery);\n              \n                istmt.setString(1, id);\n                istmt.setString(2, row.getProperty(\"username\"));\n                istmt.setString(3, row.getProperty(\"firstName\"));\n                istmt.setString(4, row.getProperty(\"lastName\"));\n                istmt.setString(5, row.getProperty(\"email\"));\n                istmt.executeUpdate();\n            }\n        }\n    } catch (Exception e) {\n        LogUtil.error(\"Sample app - StoreToMultipleSource form\", e, \"Error storing using jdbc\");\n    } finally {\n        try {\n            if(con != null) {\n                con.close();\n            }\n        } catch (SQLException e) {}\n    }\n}\n  \n//call storeData method with injected variables\nreturn storeData(element, rows, formData);"
            }
        },
        "tableName": "dir_user"
    }
}