{
    "className": "org.joget.apps.form.model.Form",
    "elements": [{
        "className": "org.joget.apps.form.model.Section",
        "elements": [{
            "className": "org.joget.apps.form.model.Column",
            "elements": [
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idFirstName",
                        "label": "Nom  :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idLastName",
                        "label": "Prénom :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idAdress",
                        "label": "Adresse e-mail :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idRole",
                        "label": "poste occupé :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idDepartement",
                        "label": "Département :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "id": "idOrg",
                        "label": "organisation :",
                        "maxlength": "",
                        "permissionHidden": "",
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                }
            ],
            "properties": {"width": "100%"}
        }],
        "properties": {
            "comment": "",
            "id": "id_info",
            "join": "",
            "label": "Générer ton CV",
            "loadBinder": {
                "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                "properties": {
                    "autoHandleFiles": "",
                    "autoHandleWorkflowVariable": "true",
                    "cacheInterval": "",
                    "script": "import java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport javax.sql.DataSource;\nimport org.joget.apps.app.service.AppUtil;\nimport org.joget.apps.form.model.Form;\nimport org.joget.apps.form.model.Element;\nimport org.joget.apps.form.model.FormData;\nimport org.joget.apps.form.model.FormRow;\nimport org.joget.apps.form.model.FormRowSet;\nimport org.joget.apps.form.service.FormUtil;\nimport org.joget.commons.util.UuidGenerator;\n \nFormRowSet f = new FormRowSet();\nf.setMultiRow(true);\n \n\nDataSource ds = (DataSource) AppUtil.getApplicationContext().getBean(\"setupDataSource\");\n \ncon = ds.getConnection();\n \nif (!con.isClosed()) {\n    \n    //String jib_id = \"#requestParam.id#\";\n    String fk = \"#currentUser.username#\";\n   \n    String x = \"select firstName, lastName, email , role ,departmentId,organizationId  from dir_user util,dir_employment emp where util.id=emp.userId and util.id=?\";\n    PreparedStatement stmt = con.prepareStatement(x);\n    stmt.setString(1, fk);\n  \n    \n    ResultSet rs = stmt.executeQuery();\n    \n         \n   \n    while (rs.next()) {\n        FormRow r1 = new FormRow();\n        r1.put(\"idFirstName\", rs.getString(1));\n        r1.put(\"idLastName\", rs.getString(2));\n        r1.put(\"idAdress\", rs.getString(3));\n        r1.put(\"idRole\", rs.getString(4));\n        r1.put(\"idDepartement\", rs.getString(5));\n        r1.put(\"idOrg\", rs.getString(6));\n        f.add(r1);\n    }\n      rs.close();\n    stmt.close();\n}\ncon.close();\n \nreturn f;"
                }
            },
            "permission": {
                "className": "",
                "properties": {}
            },
            "permissionHidden": "",
            "permissionReadonly": "",
            "readonly": "true",
            "readonlyLabel": "true",
            "regex": "",
            "reverse": "",
            "storeBinder": {
                "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                "properties": {
                    "autoHandleFiles": "",
                    "autoHandleWorkflowVariable": "true",
                    "cacheInterval": "",
                    "script": "import org.joget.commons.util.LogUtil;\nimport java.sql.*;\nimport java.util.*;\nimport javax.sql.*;\nimport org.joget.commons.util.UuidGenerator;\nimport javax.sql.DataSource;\nimport org.joget.apps.app.service.AppUtil;\n\nimport java.util.Properties;\nimport javax.mail.Flags;\nimport javax.mail.Folder;\nimport javax.mail.Message;\nimport javax.mail.MessagingException;\nimport javax.mail.NoSuchProviderException;\nimport javax.mail.Session;\nimport javax.mail.Store;\nimport javax.mail.search.FlagTerm;\n\nimport org.joget.apps.app.model.AppDefinition;\nimport org.joget.plugin.base.ApplicationPlugin;\nimport org.joget.plugin.base.Plugin;\nimport org.joget.plugin.base.PluginManager;\nimport org.joget.plugin.property.model.PropertyEditable;\nimport org.joget.plugin.base.PluginManager;\nimport java.util.Collection;\nimport org.joget.apps.app.service.AppPluginUtil;\n\n\nimport org.joget.apps.form.model.FormRowSet;\nimport org.joget.apps.form.model.FormRow;\nimport org.joget.apps.app.service.*;\nimport org.joget.apps.form.model.*;\nimport org.joget.apps.form.service.*;\nimport org.joget.commons.util.LogUtil;\nimport java.util.*;\nimport java.util.Set;\nimport org.joget.apps.app.service.AppUtil;\nimport org.joget.commons.util.SecurityUtil;\nimport org.joget.directory.dao.UserDao;\nimport org.joget.directory.dao.RoleDao;\nimport org.joget.directory.model.User;\nimport org.joget.directory.model.service.DirectoryUtil;\nimport org.joget.directory.model.service.UserSecurity;\nimport org.joget.apps.workflow.security.WorkflowUserDetails;\nimport org.joget.directory.model.service.DirectoryManager;\nimport org.joget.workflow.model.service.WorkflowUserManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.joget.workflow.util.WorkflowUtil;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport javax.servlet.http.HttpSession;\nimport javax.servlet.http.HttpServletRequest;\nimport org.springframework.security.web.savedrequest.HttpSessionRequestCache;\nimport org.springframework.security.web.savedrequest.SavedRequest;\nimport org.joget.commons.util.StringUtil;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport javax.sql.DataSource;\nimport org.joget.commons.util.UuidGenerator;\n\n\nimport org.apache.http.HttpEntity;\nimport org.apache.http.util.EntityUtils;\nimport java.nio.charset.StandardCharsets;\nimport java.io.IOException;\nimport org.apache.http.HttpResponse;\nimport org.apache.http.auth.AuthScope;\nimport org.apache.http.auth.UsernamePasswordCredentials;\nimport org.apache.http.client.CredentialsProvider;\nimport org.apache.http.client.HttpClient;\nimport org.apache.http.entity.ContentType;\nimport org.apache.http.client.methods.HttpGet;\nimport org.apache.http.client.methods.HttpPost;\nimport org.apache.http.impl.client.BasicCredentialsProvider;\nimport org.apache.http.impl.client.HttpClientBuilder;\nimport org.apache.http.impl.client.CloseableHttpClient;\n\nimport org.bson.Document;\nimport org.apache.http.entity.StringEntity;\nimport org.apache.http.impl.client.HttpClients;\n\nimport org.joget.apps.form.model.FormRowSet;\nimport org.joget.apps.form.model.FormRow;\n\n\npublic void insertLine(String query){\n    DataSource ds = (DataSource) AppUtil.getApplicationContext().getBean(\"setupDataSource\");\n    Connection con3 = ds.getConnection();\n    LogUtil.info(\"QUERY\", query);\n    try {\n        if (!con3.isClosed()) {\n                \n            String insertSql3 = query;\n                \n            PreparedStatement stmtInsert3 = con3.prepareStatement(insertSql3);            \n            ////Execute SQL statement\n            stmtInsert3.executeUpdate();\n\n        }\n        \n    } catch (Exception ex) {\n        LogUtil.error(\"Dictionnaire signalement\", ex, \"Error storing using jdbc\");\n    } finally {\n        try {\n            if (con3 != null) {\n                con3.close();\n            }\n        } catch (Exception ex) {\n            LogUtil.error(\"Dictionnaire signalement\", ex, \"Error closing the jdbc connection\");\n        }\n    }\n}\n\n\n\npublic void generateDoc(String body_src){\n    try{\n        LogUtil.info(\"IN METHOD : \", \"POST INFO\");\n      \n\n        HttpClient client = HttpClientBuilder.create().build();\n\n\n        String completeUrl = \"http://127.0.0.1:5000/generate\";\n        LogUtil.info(\"URL URL\", completeUrl);\n        HttpPost httpPost = new HttpPost(completeUrl);\n        \n        httpPost.addHeader(\"Accept\", \"application/json\");\n        httpPost.addHeader(\"Content-type\", \"application/json\");\n        httpPost.addHeader(\"Accept-Charset\", \"utf-8\");\n      \n        String body = body_src;\n\n        \n        \n        LogUtil.info(\"BODY\", body);\n        \n        StringEntity stringEntity = new StringEntity(body, \"UTF-8\");\n        stringEntity.setContentType(\"application/json\");\n       \n        httpPost.setEntity(stringEntity);\n        \n        HttpResponse response = client.execute(httpPost);\n        LogUtil.info(\"HTTPPOST\", response.toString());\n        int statusCode = response.getStatusLine().getStatusCode();\n        LogUtil.info(\"STATUS CODE\", statusCode+\"\");\n        \n    } catch (Exception ex) {\n            System.out.println(ex);\n    }\n}\n\n\n // LETTRE D'ENGAGEMENT\n String body_lettre_eng = \"{ \\\"source_path\\\":\\\"my_word_template.docx\\\", \\\"data\\\":{\\\"nom\\\":\\\"ali\\\", \\\"prenom\\\": \\\"chaabane\\\"}, \\\"output_path\\\":\\\"/Bureau/API Python\\\", \\\"output_file_name\\\":\\\"outpout_tamplate.docx\\\" }\";\n // String body_lettre_eng = \"{\\\"hé\\\":\\\"hé\\\"}\";\n //String query_lettre_eng = \"INSERT INTO jwdb.app_fd_lettreengagement ( id,c_lettreengagement,c_uuid_evaluation,c_id_internal_eval,c_username_expert) VALUES ('\"+idfrm_lttr_eng+\"','Lettre_engagement_expert.docx','\"+c_uuid_eval+\"','\"+c_id_eval+\"','\"+c_username_expert+\"');\";\n \n\n//INSERTING LINES IN DB\n//insertLine(query_lettre_eng);\n\n //GENERATING DOCS\n generateDoc(body_lettre_eng);"
                }
            },
            "visibilityControl": "",
            "visibilityValue": ""
        }
    }],
    "properties": {
        "description": "",
        "id": "idGenereCV",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "génération un CV",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "tableName": "GenereCV"
    }
}